<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{{ title or "Hub Admin" }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- LOCAL Bootstrap & app styles (offline-safe) -->
    <!-- Put bootstrap.min.css at /static/vendor/bootstrap/bootstrap.min.css -->
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/bootstrap/bootstrap.min.css') }}" />

    <!-- Your site tweaks -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}" />

    <!-- Minimal fallback if local Bootstrap is missing (keeps layout readable) -->
    <style>
      body { background:#f8f9fa; }
      .navbar { background:#212529; }
      .navbar .navbar-brand, .navbar .nav-link, .navbar-text { color:#fff; }
      .container { padding-bottom:3rem; }
      .card { box-shadow: 0 1px 2px rgba(0,0,0,.05); }
      .table thead th { white-space:nowrap; }
      .muted { color:#6b7280; }
    </style>

    {% block head %}{% endblock %}
  </head>
  <body>
    <!-- Top nav -->
    <nav class="navbar navbar-expand-lg mb-4">
      <div class="container-fluid">
        <a class="navbar-brand fw-semibold" href="/">Hub Admin</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain" aria-controls="navMain" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon" style="filter: invert(1)"></span>
        </button>
        <div id="navMain" class="collapse navbar-collapse">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link {% if request.path=='/' %}active{% endif %}" href="/">Dashboard</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if request.path.startswith('/nodes') %}active{% endif %}" href="/nodes">Nodes</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if request.path.startswith('/clips') %}active{% endif %}" href="/clips">Clips</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if request.path.startswith('/config/') and not request.path.startswith('/config/cameras') %}active{% endif %}" href="/config/">Config</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if request.path.startswith('/config/cameras') or request.path.startswith('/preview/') %}active{% endif %}" href="/config/cameras">Camera Settings</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if request.path.startswith('/admin/tools') %}active{% endif %}" href="/admin/tools">Admin Tools</a>
            </li>
          </ul>
          {% if admin_user %}
          <span class="navbar-text small">admin: {{ admin_user }}</span>
          {% endif %}
        </div>
      </div>
    </nav>

    <!-- Page content -->
    <main class="container">
      {% block content %}{% endblock %}
    </main>

    <!-- LOCAL Bootstrap bundle (JS) -->
    <!-- Put bootstrap.bundle.min.js at /static/vendor/bootstrap/bootstrap.bundle.min.js -->
    <script src="{{ url_for('static', filename='vendor/bootstrap/bootstrap.bundle.min.js') }}"></script>

    <!-- Optional: if local Bootstrap failed to load, auto-fallback to CDN (uses internet only if needed) -->
    <script>
      (function () {
        var test = document.createElement('div');
        test.className = 'd-none'; // Bootstrap utility should hide it
        document.body.appendChild(test);
        var hidden = window.getComputedStyle(test).display === 'none';
        document.body.removeChild(test);
        if (!hidden) {
          var l = document.createElement('link');
          l.rel = 'stylesheet';
          l.href = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css';
          document.head.appendChild(l);
          var s = document.createElement('script');
          s.src = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js';
          document.body.appendChild(s);
        }
      })();
    </script>

    {% block scripts %}{% endblock %}
  </body>
</html>
